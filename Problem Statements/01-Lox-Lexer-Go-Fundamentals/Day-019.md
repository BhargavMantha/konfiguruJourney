# Day 019: REPL Interactive Mode & Testing

**Month 1:** Lox Lexer & Go Fundamentals
**Phase:** Foundation
**Week:** 3 of 4 - Integration Testing & REPL Development

---

## üéØ Today's Goal

Test the REPL thoroughly, add features like syntax highlighting hints, and create more comprehensive example Lox files.

**What You'll Build:** Enhanced REPL experience with better user feedback.

---

## üìö What You'll Learn Today

**Go Fundamentals:**
- String formatting and output control
- User experience improvements
- Testing interactive applications

**REPL Enhancements:**
- Color output (ANSI codes)
- Better error formatting
- Example program library

---

## ‚úÖ Today's Tasks

### Task 1: Test REPL with Various Inputs (45 minutes)

**Manual testing checklist:**

Test these in the REPL:
```
> var x = 5;
> print "hello, world!";
> 1 + 2 * 3 - 4 / 2
> (5 + 3) * 2
> x > 5 and y < 10
> for (var i = 0; i < 10; i = i + 1) { print i; }
> fun greet(name) { return "Hello, " + name; }
> class Point { fun init(x, y) { this.x = x; this.y = y; } }
```

**Test error handling:**
```
> var x = "unterminated
> var y @ 5;
> #invalid
```

**Document any issues found!**

---

### Task 2: Add Color Output (Optional, 30 minutes)

**Add simple color support for better UX:**

```go
// Add color constants
const (
	ColorReset  = "\033[0m"
	ColorRed    = "\033[31m"
	ColorGreen  = "\033[32m"
	ColorYellow = "\033[33m"
	ColorBlue   = "\033[34m"
	ColorPurple = "\033[35m"
	ColorCyan   = "\033[36m"
	ColorGray   = "\033[37m"
)

func printColoredTokenType(tokenType tokens.TokenType) {
	var color string
	switch {
	case tokenType >= tokens.AND && tokenType <= tokens.WHILE:
		color = ColorPurple // Keywords
	case tokenType == tokens.STRING:
		color = ColorGreen // Strings
	case tokenType == tokens.NUMBER:
		color = ColorCyan // Numbers
	case tokenType == tokens.IDENTIFIER:
		color = ColorBlue // Identifiers
	default:
		color = ColorGray // Operators
	}
	fmt.Printf("%s%-15s%s", color, tokenType, ColorReset)
}

// Update run() to use colors
func run(source string) bool {
	scanner := lexer.NewScanner(source)
	tokens, errors := scanner.ScanTokens()

	if len(errors) > 0 {
		fmt.Println()
		fmt.Printf("%sErrors:%s\n", ColorRed, ColorReset)
		for _, err := range errors {
			fmt.Fprintf(os.Stderr, "  %s%s%s\n", ColorRed, err, ColorReset)
		}
		fmt.Println()
		return true
	}

	fmt.Println()
	fmt.Printf("%sTokens:%s\n", ColorGreen, ColorReset)
	for _, token := range tokens {
		if token.Type == tokens.EOF {
			continue
		}
		printColoredTokenType(token.Type)
		fmt.Printf(" %-20s", token.Lexeme)
		if token.Literal != nil {
			fmt.Printf(" = %v", token.Literal)
		}
		fmt.Println()
	}
	fmt.Println()

	return false
}
```

---

### Task 3: Create Comprehensive Example Library (60 minutes)

**Create detailed example files:**

**`examples/01-basics.lox`:**
```lox
// Basic Lox syntax examples

// Variables
var x = 10;
var y = 20;
var name = "Alice";
var active = true;

// Arithmetic
var sum = x + y;
var product = x * y;
var result = (x + y) * 2;

// Printing
print "Sum: ";
print sum;
print "Product: ";
print product;
```

**`examples/02-control-flow.lox`:**
```lox
// Control flow examples

var x = 10;

// If-else
if (x > 5) {
    print "x is greater than 5";
} else {
    print "x is not greater than 5";
}

// Logical operators
if (x > 5 and x < 15) {
    print "x is between 5 and 15";
}

// Nested conditionals
if (x > 0) {
    if (x < 20) {
        print "x is between 0 and 20";
    }
}
```

**`examples/03-loops.lox`:**
```lox
// Loop examples

// For loop
for (var i = 0; i < 5; i = i + 1) {
    print i;
}

// While loop
var count = 0;
while (count < 3) {
    print "Count: ";
    print count;
    count = count + 1;
}

// Nested loops
for (var i = 0; i < 3; i = i + 1) {
    for (var j = 0; j < 3; j = j + 1) {
        print i * j;
    }
}
```

**`examples/04-functions.lox`:**
```lox
// Function examples

fun greet(name) {
    print "Hello, " + name;
}

fun add(a, b) {
    return a + b;
}

fun multiply(x, y) {
    return x * y;
}

// Function calls
greet("World");
var result = add(5, 3);
print result;
```

**`examples/05-classes.lox`:**
```lox
// Class examples

class Point {
    fun init(x, y) {
        this.x = x;
        this.y = y;
    }

    fun display() {
        print "Point: (";
        print this.x;
        print ", ";
        print this.y;
        print ")";
    }
}

class Counter {
    fun init() {
        this.count = 0;
    }

    fun increment() {
        this.count = this.count + 1;
    }

    fun getCount() {
        return this.count;
    }
}

var p = Point(10, 20);
p.display();
```

---

### Task 4: Add Example Runner Script (30 minutes)

**Create `examples/README.md`:**
```markdown
# Lox Example Programs

This directory contains example Lox programs demonstrating various language features.

## Examples

1. **01-basics.lox** - Variables, arithmetic, printing
2. **02-control-flow.lox** - If/else statements, logical operators
3. **03-loops.lox** - For and while loops
4. **04-functions.lox** - Function declarations and calls
5. **05-classes.lox** - Class definitions and methods

## Running Examples

Run any example with:
```bash
./lox examples/01-basics.lox
```

Or use Make:
```bash
make run-example FILE=examples/01-basics.lox
```

## Testing All Examples

Test all examples at once:
```bash
for file in examples/*.lox; do
    echo "Testing $file..."
    ./lox "$file"
    echo "---"
done
```
```

**Create `scripts/test-examples.sh`:**
```bash
#!/bin/bash

echo "Testing all Lox example files..."
echo "================================="

for file in examples/*.lox; do
    echo ""
    echo "Testing: $file"
    echo "---"
    ./lox "$file"
    if [ $? -eq 0 ]; then
        echo "‚úì Success"
    else
        echo "‚úó Failed"
    fi
    echo ""
done

echo "================================="
echo "All examples tested!"
```

Make it executable:
```bash
chmod +x scripts/test-examples.sh
```

---

### Task 5: REPL History (Optional Advanced Feature, 45 minutes)

If you have extra time, add command history:

```go
var history []string

func runPrompt() {
	reader := bufio.NewReader(os.Stdin)
	history = make([]string, 0)

	printWelcome()

	for {
		fmt.Print("> ")
		line, err := reader.ReadString('\n')
		if err != nil {
			fmt.Println()
			break
		}

		line = strings.TrimSpace(line)

		if line == "exit" || line == "quit" {
			break
		}

		if line == "history" {
			printHistory()
			continue
		}

		if line == "help" {
			printHelp()
			continue
		}

		if line == "clear" {
			clearScreen()
			continue
		}

		if line == "" {
			continue
		}

		// Add to history
		history = append(history, line)

		run(line)
	}
}

func printHistory() {
	fmt.Println()
	fmt.Println("Command History:")
	for i, cmd := range history {
		fmt.Printf("  %d: %s\n", i+1, cmd)
	}
	fmt.Println()
}
```

---

### Task 6: Run All Examples and Test (20 minutes)

**Test all examples:**
```bash
make build
./scripts/test-examples.sh
```

**Verify:**
- All examples run without errors
- All tokens are correct
- REPL works smoothly
- Help commands work

---

### Task 7: Commit REPL Enhancements (10 minutes)

**Git commit:**
```bash
git add cmd/lox/main.go examples/ scripts/
git commit -m "feat: enhance REPL with colors and comprehensive examples

- Add optional color output for better token visualization
- Create 5 comprehensive example programs
- Add example README and test script
- Add command history feature (optional)
- Test all examples thoroughly

Maps to Task 11 (CLI REPL), Steps 4-5

Day 19/30: REPL enhancements complete"
```

---

## üìñ Resources

**ANSI Color Codes:**
- [ANSI Escape Codes](https://en.wikipedia.org/wiki/ANSI_escape_code)
- [Terminal Colors in Go](https://pkg.go.dev/github.com/fatih/color)

---

## ‚úÖ End-of-Day Checklist

- [ ] Thoroughly tested REPL with various inputs
- [ ] Added color output (optional)
- [ ] Created 5 comprehensive example files
- [ ] Created examples README
- [ ] Created test script for examples
- [ ] Added command history (optional)
- [ ] All examples work: `./scripts/test-examples.sh`
- [ ] REPL tested manually
- [ ] Code committed to git

**Time Spent:** ~0.5 hours (45+30+60+30+45+20+10 = 240 minutes = 4 hours)

---

## üîó Navigation

- [‚Üê Day 018: CLI REPL (Part 1)](Day-018.md)
- [‚Üí Day 020: File-based Scanning & Final Testing](Day-020.md)
- [‚Üë Month Overview](README.md)

---

## üìù Learning Notes

**REPL UX Improvements:**
- Color coding helps users understand token types
- Examples teach Lox syntax
- Command history improves productivity
- Help system guides new users

**What Makes a Great REPL:**
1. Immediate feedback
2. Clear error messages
3. Easy to use commands
4. Good examples
5. Forgiving of mistakes

---

*Progress: Day 19/30 complete* ‚≠ê
*Week 3: Integration Testing & REPL Development*

**Great work! Your REPL is now production-quality!**
